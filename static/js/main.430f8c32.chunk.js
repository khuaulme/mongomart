(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,a){e.exports=a(47)},47:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),l=a.n(c),i=a(50),s=a(19),o=a(25),m=a(3),u=a(5),d=a(6),h=a(8),p=a(7),v=a(9),E=a(2),g=a(14),f=function(e){var t=e.quantity;return 0===t?r.a.createElement("option",{value:t},"0 (Remove)"):r.a.createElement("option",{value:t},t)},b=function(e){var t=Object(g.a)(Array(26).keys()).map(function(e){return r.a.createElement(f,{quantity:e,key:e})});return r.a.createElement("select",{name:"quantity",defaultValue:e.selectedQuantity,onChange:e.updateQuantity},t)},y=function(e){var t=e.item;if(!t)return null;var a="/item/"+t._id,n="/mongomart"+t.img_url;return r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement(s.a,{to:a},t.title&&t.title)),r.a.createElement("td",{className:"muted center_text"},r.a.createElement(s.a,{to:a},r.a.createElement("img",{width:"300",src:n,alt:t.title}))),r.a.createElement("td",null,r.a.createElement(b,{selectedQuantity:t.quantity,updateQuantity:e.updateQuantity,itemId:e.itemId,userId:e.userId})),r.a.createElement("td",null,t.price),r.a.createElement("td",null,t.price*t.quantity))},N=function(e){return e.error?r.a.createElement("div",{className:"row error"},r.a.createElement("div",{className:"col-md-12"},e.message&&r.a.createElement("h2",null,e.message),r.a.createElement("p",null,e.error.name,": ",e.error.errorCodeName),r.a.createElement("p",null,e.error.message))):null},w=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(p.a)(t).call(this,e))).state={cart:{items:[]},cartError:void 0},a.updateQuantity=a.updateQuantity.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.client.auth.loginWithCredential(new m.a).then(function(){return e.props.db.collection("cart").find({userId:e.props.client.auth.currentUser.id}).first()}).then(function(t){t&&t.items&&e.setState({cart:t,cartError:null})}).catch(function(t){e.setState({cartError:t}),console.error(t)})}},{key:"updateQuantity",value:function(e,t){var a=this;if(t&&t.target&&t.target.value){var n=t.target.value;this.props.client.auth.loginWithCredential(new m.a).then(function(){return a.props.db.collection("cart").updateOne({userId:a.props.client.auth.currentUser.id,"items._id":e},{$set:{"items.$.quantity":n}})}).then(function(e){e&&e.modifiedCount&&1===e.modifiedCount&&a.setState({selectedQuantity:n})}).catch(function(e){console.error(e)})}}},{key:"renderCart",value:function(){var e=this;return this.state.cart.items.map(function(t){return r.a.createElement(y,{item:t,userId:e.state.userId,updateQuantity:function(a){return e.updateQuantity(t._id,a)},key:t._id})})}},{key:"render",value:function(){return this.state.cartError?r.a.createElement(N,{error:this.state.cartError}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("ol",{className:"breadcrumb"},r.a.createElement("li",null,r.a.createElement(s.a,{to:"/"},"Home")),r.a.createElement("li",{className:"active"},"Cart")))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("table",{className:"table table-bordered table-striped"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Product Name"),r.a.createElement("th",null,"Image"),r.a.createElement("th",null,"Quantity"),r.a.createElement("th",null,"Unit Price"),r.a.createElement("th",null,"Total"))),r.a.createElement("tbody",null,this.renderCart(),r.a.createElement("tr",null,r.a.createElement("td",null,"\xa0"),r.a.createElement("td",null,"\xa0"),r.a.createElement("td",null,"\xa0"),r.a.createElement("td",null,"\xa0"),r.a.createElement("td",null))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("button",{className:"btn btn-success",type:"submit"},"Proceed to Checkout")))))}}]),t}(n.Component),C=a(23),O=a.n(C),k=a(49);function j(e){var t=e.category;if(!t)return null;var a="/category/"+t._id;return r.a.createElement(k.a,{to:a,className:"list-group-item",activeClassName:"active"},r.a.createElement("span",{className:"badge"},t.num),t._id)}function R(e){var t=e.item;if(!t)return null;var a="/item/"+t._id,n="/mongomart"+t.img_url;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-7"},r.a.createElement(s.a,{to:a},t.img_url&&r.a.createElement("img",{className:"img-responsive",src:n,alt:""}))),r.a.createElement("div",{className:"col-md-5"},r.a.createElement("h3",null,r.a.createElement(s.a,{to:a},t.title&&t.title)),r.a.createElement("h4",null,t.slogan&&t.slogan),r.a.createElement("p",null,t.description&&t.description),r.a.createElement(s.a,{className:"btn btn-primary",to:a},"View Product",r.a.createElement("span",{className:"glyphicon glyphicon-chevron-right"})))),r.a.createElement("hr",null))}var I=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(p.a)(t).call(this,e))).state={categories:[],categoriesError:void 0,items:[],productsError:void 0},a}return Object(v.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.fetchProducts(this.props.match.params.category),this.fetchCategories()}},{key:"componentDidUpdate",value:function(e){this.props.match.params.category!==e.match.params.category&&this.fetchProducts(this.props.match.params.category)}},{key:"fetchCategories",value:function(){var e=this;this.props.client.auth.loginWithCredential(new m.a).then(function(){return e.props.db.collection("item").aggregate([{$group:{_id:"$category",num:{$sum:1}}},{$sort:{_id:1}}]).toArray()}).then(function(t){t.unshift({_id:"All",num:23}),e.setState({categories:t,categoriesError:null})}).catch(function(t){e.setState({categoriesError:t}),console.log(t)})}},{key:"fetchProducts",value:function(e){var t=this,a=e&&"All"!==e?{category:e}:{},n={sort:{_id:1}};this.props.client.auth.loginWithCredential(new m.a).then(function(){return t.props.db.collection("item").find(a,n).asArray()}).then(function(e){t.setState({items:e,productsError:null})}).catch(function(e){t.setState({productsError:e}),console.error(e)})}},{key:"getCurrPage",value:function(){var e=O.a.parse(this.props.location.search);return e.page?parseInt(e.page):0}},{key:"renderCategories",value:function(){return this.state.categoriesError?r.a.createElement(N,{error:this.state.categoriesError}):this.state.categories.map(function(e){return r.a.createElement(j,{category:e,key:e._id})})}},{key:"renderProducts",value:function(){if(this.state.productsError)return r.a.createElement(N,{error:this.state.productsError});var e=5*this.getCurrPage(),t=e+5;return this.state.items.map(function(a,n){return n>=e&&n<t?r.a.createElement(R,{item:a,key:a._id}):null})}},{key:"renderPagination",value:function(){var e=this,t=Math.ceil(this.state.items.length/5);return Object(g.a)(Array(t).keys()).map(function(t){var a=e.props.match.params.category,n=a?"/category/"+a:"/";n+="?page="+t;var c=r.a.createElement(s.a,{to:n},t+1),l=e.getCurrPage()===t?"active":"inactive";return r.a.createElement("li",{className:l,key:t},c)})}},{key:"render",value:function(){var e=this.props.match.params.category,t=e||"All";return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("ol",{className:"breadcrumb"},r.a.createElement("li",null,r.a.createElement(s.a,{to:"/"},"Home")),r.a.createElement("li",{className:"active"},t)))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-2"},r.a.createElement("div",{className:"list-group"},this.renderCategories())),r.a.createElement("div",{className:"col-md-10"},this.renderProducts(),r.a.createElement("div",{className:"row text-center"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("ul",{className:"pagination"},this.renderPagination()))))))}}]),t}(n.Component),S=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(p.a)(t).call(this,e))).state={loggedIn:!1,userName:"Unnamed user"},a.login=a.login.bind(Object(E.a)(Object(E.a)(a))),a.logout=a.logout.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.client.auth.hasRedirectResult()&&this.props.client.auth.handleRedirectResult().then(function(t){console.log(t),t&&e.setState({isLoggedIn:!0,name:t.name})}),this.props.client.auth.isLoggedIn}},{key:"login",value:function(e){if(e.preventDefault(),!this.props.client.auth.isLoggedIn){var t=new m.b;this.props.client.auth.loginWithRedirect(t)}}},{key:"logout",value:function(e){var t=this;e.preventDefault(),this.props.client.auth.isLoggedIn&&this.props.client.auth.logout().then(function(e){console.log(e),e&&t.setState({isLoggedIn:!1,name:""})})}},{key:"render",value:function(){if(this.props.client.auth.isLoggedIn){var e=this.props.client.auth.profile?this.props.client.auth.profile.name:"Unnamed user";return r.a.createElement(r.a.Fragment,null,r.a.createElement("li",null,r.a.createElement("a",{href:"#no-link",className:"no-link"},"Welcome, ",e)),r.a.createElement("li",null,r.a.createElement("a",{href:"#logout",onClick:this.logout},"Log Out")))}return r.a.createElement("li",null,r.a.createElement("a",{href:"#login",onClick:this.login},"Log In"))}}]),t}(n.Component),_=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(p.a)(t).call(this,e))).addToCart=a.addToCart.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){}},{key:"addToCart",value:function(){var e=this,t={userId:this.props.client.auth.currentUser.id,"items._id":this.props.item._id},a={$inc:{"items.$.quantity":1}};this.props.client.auth.loginWithCredential(new m.a).then(function(){return e.props.db.collection("cart").updateOne(t,a)}).then(function(t){if(t&&1!==t.modifiedCount){var a={userId:e.props.client.auth.currentUser.id},n=e.props.item;n.quantity=1;var r={$addToSet:{items:n}},c={upsert:!0};e.props.client.auth.loginWithCredential(new m.a).then(function(){return e.props.db.collection("cart").updateOne(a,r,c)}).then(function(e){}).catch(function(e){console.error(e)})}}).catch(function(e){console.error(e)})}},{key:"setNotification",value:function(){}},{key:"render",value:function(){var e=this;return this.props.item.stock>0?r.a.createElement("button",{className:"btn btn-primary",type:"submit",onClick:this.addToCart},"Add to cart",r.a.createElement("span",{className:"glyphicon glyphicon-chevron-right"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"red-text"},"Sorry, this product is out of stock"),r.a.createElement("button",{className:"btn btn-primary",type:"submit",onClick:function(){return e.setNotification()}},"Notify me ",r.a.createElement("br",null),"when in stock",r.a.createElement("span",{className:"glyphicon glyphicon-bell"})))}}]),t}(n.Component),W=function(e){return e.stars>=e.num?r.a.createElement("span",{className:"glyphicon glyphicon-star"}):r.a.createElement("span",{className:"glyphicon glyphicon-star-empty"})},P=function(e){return Object(g.a)(Array(5).keys()).map(function(t){return r.a.createElement(W,{num:t+1,stars:e.stars,key:t})})},U=function(e){return e.reviews&&0!==e.reviews.length?e.reviews.map(function(t,a){var n=new Date(t.date),c=n.getUTCFullYear()+"/"+("0"+(n.getUTCMonth()+1)).slice(-2)+"/"+("0"+n.getUTCDate()).slice(-2)+" "+("0"+n.getUTCHours()).slice(-2)+":"+("0"+n.getUTCMinutes()).slice(-2)+":"+("0"+n.getUTCSeconds()).slice(-2);return t.userId&&t.userId===e.client.auth.currentUser.id&&(t.editable=!0),r.a.createElement(r.a.Fragment,{key:a},r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h4",{className:"media-heading review-header"},t.name,r.a.createElement("small",null," ",c),t.editable&&r.a.createElement("a",{href:"#editReview",className:"edit-review"},"Edit")),r.a.createElement("div",{className:"ratings"},r.a.createElement(P,{stars:t.stars})),t.comment)),r.a.createElement("hr",null))}):r.a.createElement("p",null,"There are no reviews for this product yet...")},A=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(p.a)(t).call(this,e))).state={isWritingReview:!1,rating:5,comment:"",addReviewError:void 0},a.toggleWriteReview=a.toggleWriteReview.bind(Object(E.a)(Object(E.a)(a))),a.handleRatingChange=a.handleRatingChange.bind(Object(E.a)(Object(E.a)(a))),a.handleCommentChange=a.handleCommentChange.bind(Object(E.a)(Object(E.a)(a))),a.addReview=a.addReview.bind(Object(E.a)(Object(E.a)(a))),a}return Object(v.a)(t,e),Object(d.a)(t,[{key:"toggleWriteReview",value:function(){this.setState({isWritingReview:!this.state.isWritingReview})}},{key:"handleRatingChange",value:function(e){this.setState({rating:e.target.value})}},{key:"handleCommentChange",value:function(e){this.setState({comment:e.target.value})}},{key:"addReview",value:function(){var e=this,t={userId:this.props.client.auth.currentUser.id,productId:this.props.productId,name:this.props.client.auth.currentUser.name?this.props.client.auth.currentUser.name:"Anonymous User",comment:this.state.comment,stars:this.state.rating,date:(new Date).getTime()},a=this.props.client.getServiceClient(m.c.factory,"mm-reviews").db("mongomart");this.props.client.auth.loginWithCredential(new m.a).then(function(){return a.collection("reviews").insertOne(t)}).then(function(t){e.setState({addReviewError:null,isWritingReview:!1})}).catch(function(t){e.setState({addReviewError:t}),console.error(t)})}},{key:"render",value:function(){return this.state.isWritingReview?r.a.createElement("div",{className:"new-review"},r.a.createElement("button",{type:"button",onClick:this.toggleWriteReview,className:"cancel-new-review"},"Cancel"),r.a.createElement("p",null,r.a.createElement("label",null,"Rating:",r.a.createElement("select",{defaultValue:5,name:"rating",className:"new-review-rating",value:this.state.value,onChange:this.handleRatingChange},r.a.createElement("option",{value:"1"},"1"),r.a.createElement("option",{value:"2"},"2"),r.a.createElement("option",{value:"3"},"3"),r.a.createElement("option",{value:"4"},"4"),r.a.createElement("option",{value:"5"},"5")))),r.a.createElement("p",null,r.a.createElement("textarea",{rows:"1",cols:"50",name:"comment",placeholder:"Your comment...",value:this.state.comment,onChange:this.handleCommentChange})),r.a.createElement("button",{type:"button",onClick:this.addReview,className:"add-new-review"},"Add Review")):r.a.createElement("button",{type:"button",onClick:this.toggleWriteReview},"Add review")}}]),t}(n.Component),T=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(p.a)(t).call(this,e))).state={item:{},reviews:[],productError:void 0,reviewsError:void 0},a}return Object(v.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.fetchProduct(),this.fetchReviews()}},{key:"fetchProduct",value:function(){var e=this,t=parseInt(this.props.match.params.id);this.props.client.auth.loginWithCredential(new m.a).then(function(){return e.props.db.collection("item").find({_id:t},{limit:1}).asArray()}).then(function(t){t&&t[0]&&e.setState({item:t[0],productError:null})}).catch(function(t){e.setState({productError:t}),console.error(t)})}},{key:"fetchReviews",value:function(){var e=this,t=parseInt(this.props.match.params.id),a=this.props.client.getServiceClient(m.c.factory,"mm-reviews").db("mongomart");this.props.client.auth.loginWithCredential(new m.a).then(function(){return a.collection("reviews").find({productId:t}).asArray()}).then(function(t){t&&e.setState({reviews:t,reviewsError:null})}).catch(function(t){e.setState({reviewsError:t}),console.error(t)})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.renderProduct(),this.renderReviews())}},{key:"renderProduct",value:function(){var e=this.state.item;if(!e)return null;var t=0,a=0,n=this.state.reviews;if(n){a=n.length;for(var c=0;c<a;c++){t+=n[c].stars}a>0&&(t/=a)}var l="/category/"+e.category,i="/mongomart"+e.img_url;return this.state.productError?r.a.createElement(N,{error:this.state.productError}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("ol",{className:"breadcrumb"},r.a.createElement("li",null,r.a.createElement(s.a,{to:"/"},"Home")),r.a.createElement("li",{className:"active"},r.a.createElement(s.a,{to:l},e.category)),r.a.createElement("li",{className:"active"},e.title)))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h1",{className:"page-header"},e.title,r.a.createElement("small",null," ",e.slogan)))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement("img",{className:"img-responsive",src:i,alt:""})),r.a.createElement("div",{className:"col-md-4"},r.a.createElement("h3",null,"Product Description"),r.a.createElement("div",{className:"ratings"},r.a.createElement("p",{className:"pull-right"},a," review(s)"),r.a.createElement("p",null,r.a.createElement(P,{stars:t}))),r.a.createElement("p",null,e.description),r.a.createElement(_,{item:e,db:this.props.db,client:this.props.client}))))}},{key:"renderReviews",value:function(){return this.state.reviewsError?r.a.createElement(N,{message:"Error while fetching reviews!",error:this.state.reviewsError}):r.a.createElement("div",{className:"row reviews"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h3",{className:"page-header"},"Latest Reviews")),r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(U,{client:this.props.client,reviews:this.state.reviews}),r.a.createElement(A,{client:this.props.client,productId:this.state.item._id})))}}]),t}(n.Component),D=m.d.initializeDefaultAppClient("mongomart-vyoeg"),Q=D.getServiceClient(m.c.factory,"mm-products").db("mongomart");l.a.render(r.a.createElement(function(){return r.a.createElement(i.a,null,r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar navbar-inverse navbar-fixed-top",role:"navigation"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"navbar-header"},r.a.createElement("button",{type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":"#bs-example-navbar-collapse-1"},r.a.createElement("span",{className:"sr-only"},"Toggle navigation"),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"})),r.a.createElement(s.a,{className:"navbar-brand",to:"/"},"MongoMart")),r.a.createElement("div",{className:"collapse navbar-collapse",id:"bs-example-navbar-collapse-1"},r.a.createElement("ul",{className:"nav navbar-nav"},r.a.createElement(S,{client:D})),r.a.createElement("div",{className:"collapse navbar-collapse"},r.a.createElement("form",{className:"navbar-form navbar-right",role:"search",action:"/search"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",name:"query",placeholder:"Search"})),r.a.createElement("button",{type:"submit",className:"btn btn-default"},"Submit"),r.a.createElement(s.a,{to:"/cart"},r.a.createElement("button",{type:"button",className:"btn btn-success"},r.a.createElement("span",{className:"glyphicon glyphicon-shopping-cart","aria-hidden":"true"})," Cart"))))))),r.a.createElement("div",{className:"container"},r.a.createElement(o.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(I,Object.assign({},e,{client:D,db:Q}))}}),r.a.createElement(o.a,{path:"/category/:category",render:function(e){return r.a.createElement(I,Object.assign({},e,{client:D,db:Q}))}}),r.a.createElement(o.a,{path:"/cart",render:function(e){return r.a.createElement(w,Object.assign({},e,{client:D,db:Q}))}}),r.a.createElement(o.a,{path:"/item/:id",render:function(e){return r.a.createElement(T,Object.assign({},e,{client:D,db:Q}))}}))))},null),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.430f8c32.chunk.js.map